<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Smart Alarm Control</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 500px; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; }
        
        /* ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ */
        .clock { font-size: 48px; font-weight: bold; color: #333; margin-bottom: 20px; letter-spacing: 2px; }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .card { background: #e3f2fd; padding: 15px; border-radius: 10px; }
        .card h3 { margin: 0 0 5px 0; font-size: 14px; color: #555; }
        .card .value { font-size: 24px; font-weight: bold; color: #1565c0; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏´‡∏•‡∏±‡∏Å */
        .main-switch { margin-bottom: 25px; padding: 20px; border-radius: 10px; transition: 0.3s; cursor: pointer; border: 2px solid #ddd; }
        .main-switch.active { background-color: #e8f5e9; border-color: #4caf50; }
        .main-switch.inactive { background-color: #ffebee; border-color: #f44336; }
        .switch-label { font-size: 20px; font-weight: bold; }
        .status-text { display: block; margin-top: 5px; font-size: 14px; }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ */
        .timer-section { background: #fafafa; padding: 20px; border-radius: 10px; border: 1px dashed #ccc; }
        .timer-inputs { display: flex; justify-content: center; align-items: center; gap: 10px; margin: 15px 0; }
        input[type="number"] { width: 60px; padding: 10px; text-align: center; font-size: 18px; border: 1px solid #ccc; border-radius: 5px; }
        .btn-set { background: #2196f3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; }
        .btn-set:hover { background: #1976d2; }

        /* ‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ Buzzer ‡∏î‡∏±‡∏á */
        #alarm-alert { display: none; background: #d32f2f; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; animation: blink 1s infinite; font-weight: bold; }
        
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

<div class="container">
    <div id="alarm-alert">üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (ALARMING) üö®</div>

    <div class="clock" id="realtime-clock">00:00:00</div>

    <div class="status-grid">
        <div class="card">
            <h3>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (Temp)</h3>
            <div class="value"><span id="temp-val">--</span> ¬∞C</div>
        </div>
        <div class="card">
            <h3>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô (Soil)</h3>
            <div class="value"><span id="soil-val">--</span> %</div>
        </div>
    </div>

    <div id="master-btn" class="main-switch inactive" onclick="toggleSystem()">
        <span class="switch-label" id="btn-text">SYSTEM OFF</span>
        <span class="status-text" id="btn-subtext">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö</span>
    </div>

    <div class="timer-section">
        <h3>‚è∞ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏•‡∏∏‡∏Å (Alarm Clock)</h3>
        <div class="timer-inputs">
            <input type="number" id="input-hour" placeholder="HH" min="0" max="23">
            <span>:</span>
            <input type="number" id="input-minute" placeholder="MM" min="0" max="59">
        </div>
        <button class="btn-set" onclick="setAlarmTime()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏•‡∏∏‡∏Å</button>
        <p style="font-size: 12px; color: #666; margin-top: 10px;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="current-set-time">--:--</span></p>
    </div>
</div>

<script>
    // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡∏Å‡πä‡∏≠‡∏õ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î Arduino ‡πÄ‡∏õ‡πä‡∏∞‡πÜ)
    const firebaseConfig = {
        apiKey: "AIzaSyD3V-qYNxPh-jU8A5cEMGo4RH0fJOWa4C4",
        databaseURL: "https://kjszz-1a818-default-rtdb.firebaseio.com"
    };

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let isSystemOn = false;

    // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ Real-time
    function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        document.getElementById('realtime-clock').innerText = `${hours}:${minutes}:${seconds}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // 3. ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Firebase (Listener)
    
    // 3.1 ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ Sensor ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm
    db.ref('sensor').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.getElementById('temp-val').innerText = data.temperature.toFixed(1);
            document.getElementById('soil-val').innerText = data.soil;
            
            // ‡∏ñ‡πâ‡∏≤ Alarm ‡∏î‡∏±‡∏á ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡πÅ‡∏ñ‡∏ö‡πÅ‡∏î‡∏á
            const alertBox = document.getElementById('alarm-alert');
            if (data.alarm === true) {
                alertBox.style.display = 'block';
            } else {
                alertBox.style.display = 'none';
            }
        }
    });

    // 3.2 ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏° (Master Switch)
    db.ref('control/alarm').on('value', (snapshot) => {
        isSystemOn = snapshot.val();
        updateButtonUI();
    });

    // 3.3 ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    db.ref('control').on('value', (snapshot) => {
        const data = snapshot.val();
        if(data && data.set_hour !== undefined) {
             const h = String(data.set_hour).padStart(2, '0');
             const m = String(data.set_minute).padStart(2, '0');
             document.getElementById('current-set-time').innerText = `${h}:${m}`;
        }
    });

    // 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
    
    // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î
    function toggleSystem() {
        isSystemOn = !isSystemOn;
        // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ Firebase
        db.ref('control/alarm').set(isSystemOn);
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏õ‡∏∏‡πà‡∏°
    function updateButtonUI() {
        const btn = document.getElementById('master-btn');
        const txt = document.getElementById('btn-text');
        const sub = document.getElementById('btn-subtext');

        if (isSystemOn) {
            btn.className = "main-switch active";
            txt.innerText = "SYSTEM ARMED (‡πÄ‡∏õ‡∏¥‡∏î)";
            sub.innerText = "‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î)";
        } else {
            btn.className = "main-switch inactive";
            txt.innerText = "SYSTEM OFF (‡∏õ‡∏¥‡∏î)";
            sub.innerText = "‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÄ‡∏á‡∏µ‡∏¢‡∏ö (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î)";
        }
    }

    // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏•‡∏∏‡∏Å
    function setAlarmTime() {
        const h = parseInt(document.getElementById('input-hour').value);
        const m = parseInt(document.getElementById('input-minute').value);

        if (isNaN(h) || isNaN(m) || h < 0 || h > 23 || m < 0 || m > 59) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (0-23 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤, 0-59 ‡∏ô‡∏≤‡∏ó‡∏µ)");
            return;
        }

        // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏õ Firebase
        db.ref('control/set_hour').set(h);
        db.ref('control/set_minute').set(m);
        alert(`‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏•‡∏∏‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏õ‡πá‡∏ô ${h}:${String(m).padStart(2,'0')} ‡∏ô.`);
    }

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Alarm Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eceff1; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; width: 100%; max-width: 450px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        
        .header-badge { background: #4caf50; color: white; padding: 10px 20px; border-radius: 50px; font-weight: bold; display: inline-block; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3); }
        .clock { font-size: 56px; font-weight: 800; color: #263238; margin: 10px 0; letter-spacing: 2px; }
        
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 30px 0; }
        .card { background: #f5f7fa; padding: 20px; border-radius: 15px; border: 1px solid #e0e0e0; }
        .card h3 { margin: 0; font-size: 14px; color: #78909c; }
        .card .value { font-size: 28px; font-weight: bold; color: #37474f; margin-top: 5px; }

        .timer-box { background: #e3f2fd; padding: 20px; border-radius: 15px; border: 2px dashed #90caf9; margin-top: 20px; }
        .timer-inputs input { width: 60px; padding: 10px; font-size: 20px; text-align: center; border: 2px solid #fff; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-save { background: #1976d2; color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; margin-top: 15px; font-size: 16px; cursor: pointer; font-weight: bold; }
        .btn-save:hover { background: #1565c0; }

        /* ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô */
        #alert-box { display: none; background: #ff5252; color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="container">
    <div id="alert-box">
        <h1>üö® ALARM! üö®</h1>
        <p>‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
    </div>

    <div class="header-badge">‚óè SYSTEM ONLINE (‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</div>

    <div class="clock" id="clock">00:00:00</div>
    <div style="color: #78909c; font-size: 14px;">Real-time Monitoring</div>

    <div class="status-grid">
        <div class="card">
            <h3>Temperature</h3>
            <div class="value"><span id="t-val">--</span> ¬∞C</div>
        </div>
        <div class="card">
            <h3>Soil Moisture</h3>
            <div class="value"><span id="s-val">--</span> %</div>
        </div>
    </div>

    <div class="timer-box">
        <h3 style="margin-top:0; color:#1565c0;">‚è∞ Set Alarm Time</h3>
        <div class="timer-inputs">
            <input type="number" id="hh" placeholder="HH" min="0" max="23"> : 
            <input type="number" id="mm" placeholder="MM" min="0" max="59">
        </div>
        <button class="btn-save" onclick="saveTime()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏•‡∏∏‡∏Å</button>
        <p style="margin-bottom:0; font-size:13px; color:#546e7a;">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ: <span id="set-time">--:--</span></p>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD3V-qYNxPh-jU8A5cEMGo4RH0fJOWa4C4",
        databaseURL: "https://kjszz-1a818-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏≠‡∏á
    setInterval(() => {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString('th-TH', {hour12:false});
    }, 1000);

    // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ö‡∏≠‡∏£‡πå‡∏î
    db.ref('sensor').on('value', (snap) => {
        const d = snap.val();
        if(d) {
            document.getElementById('t-val').innerText = d.temperature.toFixed(1);
            document.getElementById('s-val').innerText = d.soil;
            
            // ‡∏ñ‡πâ‡∏≤‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡πà‡∏á‡∏°‡∏≤‡∏ß‡πà‡∏≤ Alarm = true ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏î‡∏á
            if(d.alarm) {
                document.getElementById('alert-box').style.display = 'block';
            } else {
                document.getElementById('alert-box').style.display = 'none';
            }
        }
    });

    // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
    db.ref('control').on('value', (snap) => {
        const d = snap.val();
        if(d) document.getElementById('set-time').innerText = `${d.set_hour}:${String(d.set_minute).padStart(2,'0')}`;
    });

    // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤
    function saveTime() {
        const h = parseInt(document.getElementById('hh').value);
        const m = parseInt(document.getElementById('mm').value);
        if(!isNaN(h) && !isNaN(m)) {
            db.ref('control/set_hour').set(h);
            db.ref('control/set_minute').set(m);
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß!");
        }
    }
</script>

</body>
</html>

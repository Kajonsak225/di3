<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Plant Monitor</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h1 { color: #2c3e50; margin-bottom: 1.5rem; }
        .sensor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .sensor-box { padding: 15px; border-radius: 15px; background: #f8f9fa; }
        .label { font-size: 0.8rem; color: #7f8c8d; text-transform: uppercase; }
        .value { font-size: 1.5rem; font-weight: bold; color: #2980b9; margin-top: 5px; }
        .status { padding: 10px; border-radius: 10px; margin-top: 10px; font-weight: bold; }
        .alarm-on { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
        .alarm-off { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
        button { width: 100%; padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.3s; margin-top: 10px; }
        .btn-on { background: #e74c3c; color: white; }
        .btn-off { background: #2ecc71; color: white; }
        .btn-on:hover { background: #c0392b; }
        .btn-off:hover { background: #27ae60; }
    </style>
</head>
<body>

<div class="card">
    <h1>üå± Smart Plant</h1>
    
    <div class="sensor-grid">
        <div class="sensor-box">
            <div class="label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
            <div class="value"><span id="temp">--</span>¬∞C</div>
        </div>
        <div class="sensor-box">
            <div class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô</div>
            <div class="value"><span id="soil">--</span>%</div>
        </div>
    </div>

    <div id="alarmStatus" class="status alarm-off">
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ (Buzzer OFF)
    </div>

    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

    <div class="label" style="margin-bottom: 10px;">‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (Web Override)</div>
    <button id="btnControl" class="btn-off" onclick="toggleAlarm()">‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ã‡πÄ‡∏£‡∏ô</button>
</div>

<script>
    // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÉ‡∏ô Arduino ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
    const firebaseConfig = {
        apiKey: "AIzaSyD3V-qYNxPh-jU8A5cEMGo4RH0fJOWa4C4",
        databaseURL: "https://kjszz-1a818-default-rtdb.firebaseio.com"
    };

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°
    let currentWebAlarm = false;

    // --- 1. ‡∏ü‡∏±‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Sensor (Real-time) ---
    database.ref('sensor').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.getElementById('temp').innerText = data.temperature.toFixed(1);
            document.getElementById('soil').innerText = data.soil;
            
            const alarmDiv = document.getElementById('alarmStatus');
            if (data.alarm) {
                alarmDiv.innerText = "üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥!";
                alarmDiv.className = "status alarm-on";
            } else {
                alarmDiv.innerText = "‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥";
                alarmDiv.className = "status alarm-off";
            }
        }
    });

    // --- 2. ‡∏ü‡∏±‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏à‡∏≤‡∏Å Database ---
    database.ref('control/alarm').on('value', (snapshot) => {
        currentWebAlarm = snapshot.val();
        const btn = document.getElementById('btnControl');
        if (currentWebAlarm) {
            btn.innerText = "‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ã‡πÄ‡∏£‡∏ô";
            btn.className = "btn-on";
        } else {
            btn.innerText = "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ã‡πÄ‡∏£‡∏ô";
            btn.className = "btn-off";
        }
    });

    // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ---
    function toggleAlarm() {
        const nextState = !currentWebAlarm;
        database.ref('control/alarm').set(nextState);
    }
</script>

</body>
</html>
